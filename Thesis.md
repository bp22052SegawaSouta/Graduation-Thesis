# 大規模言語モデルを用いたドメインモデル生成における網羅性向上とベストプラクティスの組み込み

## 初めに
### 研究背景
現在のソフトウェア開発は複雑化の一途を辿っており、その解決策としてEric Evansによって提唱されたドメイン駆動設計(DDD: Domain-Driven Design)が注目されている。(E. Evans, Domain-Driven Design: Tackling Complexity in the Heart of Software, Addison-Wesley Professional, 2003.)

DDDは、ソフトウェア開発をより効率的かつ顧客のニーズに合致させる強力な手法である一方で、その中核をなすドメインモデルの作成は、非常に難易度が高く、多大な時間と労力を要するという課題がある。この課題に対し、古くからドメイン知識を含む文書を自然言語処理技術で分析し、モデリングを補助する研究が盛んに行われてきた。近年では、大規模言語モデル(LLM: Large Language Model)を用いてドメインモデルを生成する研究も進められている。しかし、現状のLLMが生成するモデルは完全ではなく、特に要素の網羅性の低さや、モデリングにおけるベストプラクティスの欠如が大きな課題として挙げられている。本研究では、これらの課題を解決するため、LLMベースのAIエージェントを開発し、出力されるドメインモデルの要素網羅性を向上させ、モデリングのベストプラクティスを組み込むことを目指す。

### 研究課題
LLMによるドメインモデルの生成における課題は大きく二つある。一つは生成したモデルの要素の網羅性が低いということである。特に与えた情報に曖昧な部分が発生した場合、該当箇所に関係する部分を無視してモデルを生成してしまうといった問題が発生している。

もう一つは出力されたモデルがモデリングにおけるベストプラクティスを無視してしまうといったものである。

### 研究目的
本研究の目的はLLMを利用したモデル生成において課題とされていた要素の網羅性の低さとベストプラクティスの組み込みを行うことである。この目的の達成のためLLMベースのAIエージェントを作成し、モデル作成を支援できるようなツールを作成する。

### 本稿の構成
本稿は以下の構成で記述する。

**2章 関連研究**では、本研究の基盤となるドメイン駆動設計の概要を述べ、LLMを用いたドメインモデル生成に関する先行研究を紹介する。また、それらの研究で残された課題を明確にし、本研究の位置付けを明らかにする。

**3章 提案手法**では、研究目的を達成するために開発したLLMベースのAIエージェントのアーキテクチャと、その動作プロセスについて詳述する。特に、要素の網羅性を向上させるための仕組みと、モデリングのベストプラクティスを組み込むための具体的なアプローチに焦点を当てる。

**4章 評価実験**では、提案手法の有効性を検証するために実施した実験について述べる。既存手法との比較を通じて、提案手法がドメインモデルの網羅性や品質をどの程度向上させたかを定量的に評価し、その結果を考察する。

**5章 結論**では、本研究で得られた成果を総括し、今後の展望と残された課題について述べる。

## 関連研究
### ドメイン駆動設計
Eric Evansによって提唱された設計手法

### LLMベースのモデリングにおける質問分解アプローチの適用
#### 概要
文献1では大規模言語モデル(LLM: Large Language Model)を用いてドメインモデルを自動生成するための新しいアプローチとして質問分解というアプローチを提案している。このアプローチは従来の単一のプロンプトでモデル全体を生成しようとする手法において課題とされていた、複雑なタスクに対応しきれないという課題や指示の一部を無視してしまうことによる生成モデルの精度の低さに対して、細かくタスク分けを行うことによって改善を図っている。


#### 提案手法
この論文で提案されている質問分解を用いたアプローチの核心は、複雑なドメインモデルの生成というタスクを、エンジニアが実際にモデリングを行う際の思考プロセスに倣って、LLMが比較的解決しやすい粒度にタスクを分割するという点にある。
提案手法は大きく分けて以下の4つのステップで構成されている。

#### 1 クラスと属性の生成
システムの使用箇所から、モデルの基本要素となるクラスと属性を特定

#### 2 クラスの抽出
ステップ1で生成されたテキストからクラス名をプログラムで正確に抽出

#### 3 関連の生成
抽出されたクラスを基に、クラス間の関係性(関連、集約、継承)を生成

#### 4 結合とモデル生成
すべてのステップの結果を統合し、最終的なクラスモデルをプログラムで構築

引用figure2を張り付ける

#### 評価
質問分解アプローチでは従来の単一プロンプト手法と比較して、モデル要素の再現率(Recall)と総合的な精度(F1スコア)が大幅に向上した。また、プロンプトに専門知識を導入することによって生成品質が向上するという結果も得られた。

#### 課題
この提案手法においてF1スコアは大幅に向上したものの、実務でそのまま利用できるレベルにはまだ達しておらず、さらなる改善が必要であるとされている。また、初期のステップにおいて間違いが発生した場合、その後のステップにも悪影響を与えてしまうといった課題が残されていた。



### LLMを用いたドメインモデリングの完全自動化
#### 概要
文献2では、LLM（GPT-3.5及びGPT-4）が人間による操作なしで、テキスト形式の要求仕様からどの程度高品質なドメインモデル(クラス、属性、関連)を自動生成できるかを評価することを目的としている。

#### 提案手法
文献2ではLLMのモデリング能力の評価のため、出力形式の定義を行い、その後LLMに与えるプロンプトを工夫し、以下の3つの主要な手法を比較検討した。
#### 1 ゼロショット(Zero-shot)
LLMに一切の例を与えずに、タスクの目的と出力形式の指示と対象となる問題記述のみを与える手法。最もシンプルで、LLMが持つ汎用的な能力を試せる。

#### 2 Nショット(N-shot)
タスクの指示と記述問題に加え、N個の「問題記述とそれに対応する正解ドメインモデル」のペアを具体例としてプロンプトに含める手法。これによってLLMは具体的な入出力の形式と内容を学習し、より精度の高い出力を目指す。本論文では1-shotと2-shotが実験された。

#### 3 Chain-of-Thought(CoT)
N-shotを発展させた手法。単に問題と最終的な答えのペアを示すのではなく、問題記述の各部が、ドメインモデルのどの要素(クラス、属性、関連など)に結び付くかという中間的な思考プロセスを例に含めて行う。これによって、LLMが複雑なタスクを段階的に解決する方法を学習し、性能が向上することが期待される。
この3つの手法をそれぞれGPT-3.5とGPT-4の2つのモデルで実験した。しかし、各出力があらかじめ定義した出力形式に従うとは限らないため、後処理を行っている。

#### 評価
本論文ではクラス、属性、関連の3つの要素それぞれについて、生成されたモデルと専門家による参照モデルを比較して、以下の3つの定量的指標をもって評価している。

#### 1 適合率(Precision)
生成された要素のうち、どれだけが正しかったか

#### 2 再現率(Recall)
正解モデルに含まれる要素のうち、どれだけを正しく生成(網羅)できたか。

#### 3 F1スコア
適合率と再現率の調和平均
この3つの指標を使い、各RQに対して分析を行っている。

RQ1：LLMは自動ドメインモデリングをどの程度うまく実行できるか
については現状では完全自動化は実用的でないという結論になった。全体として適合率は高かったものの再現率が低く、特に関連の特定が著しく苦手であることが示された。

RQ2：プロンプトエンジニアリングの違いによる影響
例の提示は有効であるものの、Chain-of-Thoughtは逆効果になるという結果になった。これに対して著者はドメインモデリングがテキスト全体を包括的に理解する必要があり、この特性がChain-of-Thoughtと相性が悪かった可能性があると分析している。

RQ3：評価したLLMの中ではどれが最も高性能だったか
結論としてGPT-4が高性能であった。どの要素においてもGPT-3.5を上回る結果となった。


### ドメイン駆動設計とは
#### 概要
ドメイン駆動設計とは2003年にEric Evansによって提唱された設計手法である。この手法は複雑なソフトウェア開発を効果的に進めるためのアプローチであり、ソフトウェアの核心であるドメイン（業務領域）のモデルを設計の中心に据えることを特徴とする。DDDは、大きく「戦略的設計」と「戦術的設計」の2つのパートから構成される。

**戦略的設計**は、大規模で複雑なドメインをどのように分割し、チーム間で協調して開発を進めるかというマクロな視点を提供する。その中心的な概念には、開発者だけでなく顧客を含めたプロジェクト関係者全員が共有する「ユビキタス言語」や、言語とモデルが特定の文脈（コンテキスト）内でのみ一貫性を持つことを保証する「境界づけられたコンテキスト」がある。

**戦術的設計**は、ドメインモデルを構成する個々の要素（ビルディングブロック）をどのように設計するかというミクロな視点を提供する。これには、一意な識別子を持ちライフサイクルを通じて追跡される「エンティティ」、属性の集合体であり識別子を持たない「値オブジェクト」、複数のオブジェクトを一つの単位として扱う「集約」などが含まれる。

本研究では、特にこの戦術的設計で用いられるドメインモデルの要素（クラス、属性、関連）をLLMによって生成することを目的としている。


## 提案手法
### 概要
先行研究ではどちらもLLMを用いて出力したモデルは完全ではなく、特に関連の特定やモデリングにおけるベストプラクティスがうまく適用されていないことが大きな課題点として挙げられていた。そのため本研究では、LLMベースのAIエージェントを開発することによってモデル全体の網羅性の向上とベストプラクティスの組み込みを行うことを目指す。

### 開発したエージェントの構成
今回開発するエージェントでは文献1において効果のあったモデリングタスクの分割を組み込み、生成したモデルをLLM自身にチェックさせるセルフリフレクションを最後のステップに組み込み精度の向上を目指している。
また、RAG(Retrieval Augmented Generation)を活用することによって、プロンプトにそのまま記述することが難しいドメイン知識やモデリングにおける全体的な知識を導入している。全体的なエージェントの構成は図（？）のようになっている。

### エージェントの動作フロー
初期段階でモデリングに関する知識はRAGを通じて導入する。初めに利用者はモデリングを行う領域に関係するドメイン知識をRAGを利用し導入する。その後、プロンプトでモデリングを行うよう指示を行う。UI上で解析を行うボタンを押すと自動でタスクの分解が行われ、そのプラン通りにモデリングを行う。最終的に生成されたモデルは最大3回のチェックを通して改善され、最終的なモデルとしてPlantUMLで表示される。この最終的なモデルに関しては、問題点があればそこに対して修正を行えるよう、フィードバックを行える機能を追加している。